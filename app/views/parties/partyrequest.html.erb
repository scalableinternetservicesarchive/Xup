<h1>Requests</h1>

<h4>Requests by other users</h4>
<%# This table shows all the requests the current user get. %>
<%# Notice that these requests are sent by other users. %>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Party Name</th>
        <th>User</th>
        <th>Message</th>
        <th>Status</th>
        <th colspan="3"></th>
      </tr>
    </thead>
	
    <tbody>
      <% @parties = Party.where(owner: current_user.name) %>
      <% @parties.each do |party| %>
        <% @requests = party.join_members.pluck(:user_id) %>
        <% @requests.each do |request| %>
        <tr>
          <td><%= party.name %></td>
          <td><%= User.find(request).name %></td>
          <td><%= User.find(request).name%> wants to join this party: <%= party.name%></td>
          <td><%= party.join_members.find_by_user_id(request).status %></td>
          <td><%= link_to 'Add', edit_join_member_path(party.join_members.find_by_user_id(request)), class: 'btn btn-info btn-sm' %></td>
          <td><%= link_to 'Reject', edit_join_member_path(party.join_members.find_by_user_id(request)), class: 'btn btn-info btn-sm' %></td>
        </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
</div>

<br>

<h4>Requests by me</h4>
<%# This table shows all the requests the current user sends. %>
<%# Notice that these requests are sent by current user. %>
<div class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Party Name</th>
        <th>Owner</th>
        <th>Location</th>
        <th>Time</th>
        <th>Status</th>
        <th colspan="3"></th>
      </tr>
    </thead>
	
    <tbody>
      <% @party_ids = JoinMember.where(user_id: current_user.id).pluck(:party_id) %>
      <% @party_ids.each do |party_id| %>
      <% party = Party.find(party_id) %>
        <tr>
          <td><%= party.name %></td>
          <td><%= party.owner %></td>
          <td><%= party.location %></td>
          <td><%= party.time %></td>
          <td><%= JoinMember.where(user_id: current_user.id).find_by_party_id(party_id).status %></td>
          <td><%= link_to 'Edit', edit_join_member_path(JoinMember.where(user_id: current_user.id).find_by_party_id(party_id)), class: 'btn btn-info btn-sm' %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<br>

<%= link_to 'New Party', new_party_path, class: 'btn btn-success btn-sm' %>
